<h1>Site Arpège</h1>
<div class="content" *ngIf="data">
    <h2>Rentabilité</h2>
    <div class="current-year">
        <div>
            <h3>{{ data.per_year[0].year }}</h3>
            <span class="renta">{{ data.per_year[0].value >= 0 ? '+' : '' }}{{ data.per_year[0].value | percent:'1.2-3' }}</span>
            <span [amount]="[data.per_year[0].plus, {alwaysSign: true, color: true}]"></span>
            <span [amount]="[data.per_year[0].minus, {alwaysSign: true, color: true}]"></span>
        </div>
        <div class="months" height="300">
            <ng-container *ngFor="let m of data.per_month">
                <div *ngIf="m.year === data.per_year[0].year" class="month">
                    <h3>{{ getMonth(m.month) }}</h3>
                    <ng-container *ngIf="m.value_plus != 0 || m.value_minus != 0; else elseBlock">
                        <canvas baseChart
                            [data]="[m.value_plus, m.value_minus]"
                            [labels]="['Entrées', 'Sorties']"
                            [colors]="[{backgroundColor: ['green', 'red']}]"
                            [options]="options"
                            [legend]="false"
                            chartType="doughnut"></canvas>
                        <span class="month-percent">
                                {{ m.value_plus >= -m.value_minus ? '+' : '' }}{{ (m.value_plus / -m.value_minus) - 1 | percent:'1.0-1' }}
                        </span>
                        <span [amount]="[m.value_plus, {alwaysSign: true, color: true}]"></span>
                        <span [amount]="[m.value_minus, {alwaysSign: true, color: true}]"></span>
                    </ng-container>
                    <ng-template #elseBlock>
                        <canvas baseChart
                            [data]="[1]"
                            [labels]="['Aucune transaction']"
                            [colors]="[{backgroundColor: ['lightgray']}]"
                            [options]="options"
                            [legend]="false"
                            chartType="doughnut"></canvas>
                    </ng-template>
                </div>
            </ng-container>
        </div>
    </div>
    <div class="previous-years">
        <ng-container *ngFor="let py of data.per_year; index as i">
            <div *ngIf="i > 0">
                <h3>{{ py.year }}</h3>
                <span class="renta">{{ py.value >= 0 ? '+' : '' }}{{ py.value | percent:'1.2-3' }}</span>
                <span [amount]="[py.plus, {alwaysSign: true, color: true}]"></span>
                <span [amount]="[py.minus, {alwaysSign: true, color: true}]"></span>
            </div>
        </ng-container>
    </div>

    <div class="down-data">
        <div>
            <h2>Dépenses de base</h2>
            <table>
                <tbody>
                    <ng-container *ngFor="let row of data.start">
                        <tr *ngIf="row.title != 'Coût du crédit'">
                            <td>{{row.title}}</td>
                            <td [amount]="[-row.value, {alwaysSign: true, color: true}]"></td>
                        </tr>
                    </ng-container>
                </tbody>
                <tfoot>
                    <tr>
                        <th>Total</th>
                        <th [amount]="[-data.cost+30470, {alwaysSign: true, color: true}]"></th>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div>        
            <h2>Dernières transactions</h2>
            <table>
                <tbody>
                    <tr *ngFor="let row of data.last">
                        <td>{{row.date | date:'dd/MM/yy'}}</td>
                        <td>{{row.title}}</td>
                        <td [amount]="[row.value, {alwaysSign: true, color: true}]"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>



    <!--<div class="year" *ngFor="let y of realEstateData">
        <table>
            <caption>{{ y.year }}</caption>
            <tbody>
                <tr *ngFor="let row of y.data">
                    <td>{{row.date | date:'dd/MM/yy'}}</td>
                    <td>{{row.title}}</td>
                    <td [amount]="row.value < 0 ? [row.value, {alwaysSign: true, color: true}] : null"></td>
                    <td [amount]="row.value >= 0 ? [row.value, {alwaysSign: true, color: true}] : null"></td>
                    <td>{{ row.value > 0 && row.taxexempt == "1" ? '*' : '' }}</td>
                </tr>
            </tbody>
            <tbody class="total">
                <tr>
                    <th colspan="2">Total</th>
                    <th [amount]="[y.total.minus ? y.total.minus : 0, {alwaysSign: true, color: true}]"></th>
                    <th [amount]="[y.total.plus ? y.total.plus : 0, {alwaysSign: true, color: true}]"></th>
                </tr>
                <tr>
                    <td colspan="2">dont défiscalisables</td>
                    <td [amount]="[y.taxexempt, {color: true}]"></td>
                </tr>
            </tbody>
            <tbody class="deficits" *ngIf="y.previousDeficit">
                <tr>
                    <td colspan="2">Déficit précédent</td>
                    <td [amount]="[y.previousDeficit]"></td>
                </tr>
            </tbody>
        </table>
        <div class="to-declare">A déclarer : <span [amount]="[y.todeclare, {alwaysSign: true, color: true}]"></span></div>
        <div class="profitability">Rendement net-net : <span>{{y.profitability ? y.profitability : 0 | percent:'1.1-1'}}</span></div>
    </div>-->
</div>